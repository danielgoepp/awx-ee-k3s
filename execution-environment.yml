---
version: 3

images:
  base_image:
    name: registry.fedoraproject.org/fedora:42

dependencies:
  python_interpreter:
    package_system: python3
  ansible_core:
    package_pip: ansible-core
  ansible_runner:
    package_pip: ansible-runner
  system:
  - openssh-clients
  - sshpass
  - openssl
  - curl
  - tar
  - gzip
  - git
  - kubernetes
  galaxy:
    collections:
    - name: community.general
    - name: community.kubernetes
    - name: kubernetes.core
    
additional_build_steps:
  append_final:
    - RUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3
    - RUN chmod 700 get_helm.sh
    - RUN ./get_helm.sh
    - ENV HELM_PLUGINS=/usr/local/share/helm/plugins
    - RUN mkdir -p $HELM_PLUGINS
    - RUN helm plugin install https://github.com/databus23/helm-diff
